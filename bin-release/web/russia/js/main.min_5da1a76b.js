var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,a){function o(t){try{h(r.next(t))}catch(e){a(e)}}function s(t){try{h(r["throw"](t))}catch(e){a(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(o,s)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(o=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){h.label=i[1];break}if(6===i[0]&&h.label<o[1]){h.label=o[1],o=i;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(i);break}o[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],a=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Data=function(){function t(){this.List=new Array(64),this.Score=0}return t.prototype.Init=function(){for(var t=0;64>t;t++){var e=new Piece;e.Color=-1,e.Index=t,this.List[t]=e}this.initBrick()},t.prototype.initBrick=function(){},t.prototype.AddBrick=function(t,e,i,r){if(0>e||0>i)return!1;for(var n=e+8*i,a=Brick.BrickMap[t],o=0;o<a.DotList.length;o++){if(n+a.DotList[o]>63)return!1;if(-1!=this.List[n+a.DotList[o]].Color)return!1}for(var o=0;o<a.DotList.length;o++)this.List[n+a.DotList[o]].Color=r;return this.Score+=a.DotList.length,!0},t.prototype.Clean=function(){for(var t={},e=new Array,i=0;8>i;i++){for(var r=!0,n=0;8>n;n++)if(-1==this.List[8*i+n].Color){r=!1;break}if(r)for(var n=0;8>n;n++)t[8*i+n]=8*i+n}for(var n=0;8>n;n++){for(var r=!0,i=0;8>i;i++)if(-1==this.List[8*i+n].Color){r=!1;break}if(r)for(var i=0;8>i;i++)t[8*i+n]=8*i+n}var a;for(a in t){e.push(a),this.Score++;var o=this.List[a];null!=o&&(o.Color=-1)}return e},t.prototype.Check=function(){return!1},t.prototype.Reduce=function(){for(var t=new Array,e=new Array,i=0;i<this.List.length;i++)-1!=this.List[i].Color&&e.push(this.List[i].Index);for(var r=Math.floor(e.length/2),n=-1;;){if(0>=r)break;if(n>=e.length-1)break;var a=Math.floor(2*Math.random())+1;t.push(e[n+a]),n+=2,r--}for(var i=0;i<t.length;i++)this.List[t[i]].Color=-1;return t},t}();__reflect(Data.prototype,"Data");var Piece=function(){function t(){}return t}();__reflect(Piece.prototype,"Piece");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.addChild(new Scene)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function n(t){e.call(r,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var h=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(r,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Brick=function(){function t(t,e,i,r,n,a){this.Type=0,this.DotList=new Array,this.SmallX=0,this.SmallY=0,this.BigX=0,this.BigY=0,this.SmallSide=26,this.BigSide=84,this.SmallGap=2,this.BigGap=4,this.Type=t,this.SmallX=e,this.SmallY=i,this.BigX=r,this.BigY=n,this.DotList=a}return t.BrickMap={1:new t(1,57,57,180,180,[0]),2:new t(2,43,57,136,180,[0,1]),3:new t(3,29,57,92,180,[0,1,2]),4:new t(4,15,57,48,180,new Array(0,1,2,3)),5:new t(5,1,57,4,180,new Array(0,1,2,3,4)),6:new t(6,57,43,180,136,new Array(0,8)),7:new t(7,57,29,180,92,new Array(0,8,16)),8:new t(8,57,15,180,48,new Array(0,8,16,24)),9:new t(9,57,1,180,4,new Array(0,8,16,24,32)),10:new t(10,43,43,136,136,new Array(0,1,8,9)),11:new t(11,29,29,92,92,new Array(0,1,2,8,9,10,16,17,18)),12:new t(12,43,43,136,136,new Array(1,8,9)),13:new t(13,43,43,136,136,new Array(0,8,9)),14:new t(14,43,43,136,136,new Array(0,1,9)),15:new t(15,43,43,136,136,new Array(0,1,8)),16:new t(16,43,29,136,92,new Array(0,8,16,17)),17:new t(17,29,43,92,136,new Array(2,8,9,10)),18:new t(18,43,29,136,92,new Array(0,1,9,17)),19:new t(19,29,43,92,136,new Array(0,1,2,8)),20:new t(20,43,29,136,92,new Array(1,9,16,17)),21:new t(21,29,43,92,136,new Array(0,1,2,10)),22:new t(22,43,29,136,92,new Array(0,1,8,16)),23:new t(23,29,43,92,136,new Array(0,8,9,10)),24:new t(24,29,43,92,136,new Array(0,1,9,10)),25:new t(25,29,43,92,136,new Array(1,2,8,9)),26:new t(26,29,43,92,136,new Array(1,8,9,10)),27:new t(27,29,43,92,136,new Array(0,1,2,9)),28:new t(28,29,29,92,92,new Array(0,1,2,10,18)),29:new t(29,29,29,92,92,new Array(2,10,16,17,18)),30:new t(30,29,29,92,92,new Array(0,8,16,17,18)),31:new t(31,29,29,92,92,new Array(0,1,2,8,16))},t.ColorList=new Array(11977370,8630171,13158569,16371117,16555418,16663397,9082747,16044032,15041288,14440210,4557204),t}();__reflect(Brick.prototype,"Brick");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Board=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ColorList=new Array(64),e}return __extends(e,t),e.prototype.bgInit=function(){this.Layer=new egret.Shape,this.Layer.graphics.beginFill(0,1),this.Layer.graphics.drawRect(0,0,708,708),this.Layer.graphics.endFill(),this.addChild(this.Layer);for(var t=0;64>t;t++)this.darwGrid(t)},e.prototype.darwGrid=function(t){var e=Math.floor(t/8),i=t%8,r=new egret.Shape;r.graphics.beginFill(4532007,1),r.graphics.drawRect(4+88*i,4+88*e,84,84),r.graphics.endFill(),this.addChild(r)},e.prototype.DrawLayerGrid=function(t,e){var i=Math.floor(t/8),r=t%8,n=new egret.Shape;n.graphics.beginFill(e,1),n.graphics.drawRect(4+88*r,4+88*i,84,84),n.graphics.endFill(),this.ColorList[t]=n,this.addChild(n)},e.prototype.DeleteLayerGrid=function(t){var e=this.ColorList[t];null!=e&&this.removeChild(e)},e.prototype.Init=function(){this.bgInit()},e}(egret.Sprite);__reflect(Board.prototype,"Board");var Bottom=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.SmallBrickList=new Array(3),e}return __extends(e,t),e.prototype.bgInit=function(){this.Layer=new egret.Shape,this.Layer.graphics.beginFill(4532007,1),this.Layer.graphics.drawRect(0,0,716,200),this.Layer.graphics.endFill(),this.addChild(this.Layer)},e.prototype.AddSmallBrick=function(t,e,i){var r=new BrickView;return r.Order=e,r.Color=t,r.Type=i,r.GenSmallBrick(t,i),r.x=140+140*e,r.y=30,this.addChild(r),this.SmallBrickList[e]=r,r},e.prototype.AddBigBrick=function(t,e,i){var r=new BrickView;return r.Order=e,r.Color=t,r.Type=i,r.GenBigBrick(t,i),r.x=12+140*e,r.y=-356,this.addChild(r),r},e.prototype.DelAllSmall=function(){for(var t=0;t<this.SmallBrickList.length;t++)this.removeChild(this.SmallBrickList[t])},e.prototype.CheckEmpty=function(){for(var t=0;t<this.SmallBrickList.length;t++)if(!this.SmallBrickList[t].IsDel)return!1;for(var t=0;t<this.SmallBrickList.length;t++)this.removeChild(this.SmallBrickList[t]);return!0},e.prototype.hammerInit=function(){this.Hammer=new egret.Sprite;var t=new egret.Shape;t.graphics.beginFill(16777215,.5),t.graphics.drawRect(20,40,100,50),t.graphics.endFill(),this.Hammer.addChild(t);var e=new egret.Shape;e.graphics.beginFill(16777215,.5),e.graphics.drawRect(50,90,40,75),e.graphics.endFill(),this.Hammer.addChild(e),this.addChild(this.Hammer)},e.prototype.changeInit=function(){this.Change=new egret.Sprite,this.Change.graphics.beginFill(16777215,.5),this.Change.graphics.drawArc(640,100,60,0,2*Math.PI),this.Change.graphics.endFill(),this.addChild(this.Change)},e.prototype.Init=function(){this.bgInit(),this.hammerInit(),this.changeInit()},e}(egret.Sprite);__reflect(Bottom.prototype,"Bottom");var BrickView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Order=-1,e.Color=0,e.Type=0,e.IsDel=!1,e}return __extends(e,t),e.prototype.GenSmallBrick=function(t,e){for(var i=Brick.BrickMap[e],r=0;r<i.DotList.length;r++){var n=new egret.Shape;n.graphics.beginFill(t,1);var a=i.SmallX+Math.floor(i.DotList[r]%8)*(i.SmallGap+i.SmallSide),o=i.SmallY+Math.floor(i.DotList[r]/8)*(i.SmallGap+i.SmallSide);n.graphics.drawRect(0,0,i.SmallSide,i.SmallSide),n.graphics.endFill(),n.x=Math.floor(a),n.y=o,this.addChild(n)}},e.prototype.GenBigBrick=function(t,e){for(var i=Brick.BrickMap[e],r=0;r<i.DotList.length;r++){var n=new egret.Shape;n.graphics.beginFill(t,1);var a=i.BigX+Math.floor(i.DotList[r]%8)*(i.BigGap+i.BigSide),o=i.BigY+Math.floor(i.DotList[r]/8)*(i.BigGap+i.BigSide);n.graphics.drawRect(0,0,i.BigSide,i.BigSide),n.graphics.endFill(),n.x=Math.floor(a),n.y=o,this.addChild(n)}},e}(egret.Sprite);__reflect(BrickView.prototype,"BrickView");var MessageView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Text=new egret.TextField,e.Bg=new egret.Shape,e.YesButton=new egret.Shape,e.NoButton=new egret.Shape,e.Type=0,e}return __extends(e,t),e.prototype.Init=function(){var t=new egret.Shape;t.graphics.beginFill(12623,1),t.graphics.drawRect(0,0,450,200),t.graphics.endFill(),this.addChild(t),this.YesButton.graphics.beginFill(13421225,.5),this.YesButton.graphics.drawRect(30,110,165,50),this.YesButton.graphics.endFill(),this.addChild(this.YesButton),this.YesButton.touchEnabled=!0;var e=new egret.TextField;e.text="确定",e.size=32,e.x=(225-e.width)/2,e.y=120,e.textColor=12623,this.addChild(e),this.NoButton.graphics.beginFill(13421225,.5),this.NoButton.graphics.drawRect(255,110,165,50),this.NoButton.graphics.endFill(),this.addChild(this.NoButton),this.NoButton.touchEnabled=!0;var i=new egret.TextField;i.text="取消",i.size=32,i.x=225+(225-i.width)/2,i.y=120,i.textColor=12623,this.addChild(i),this.Text.text="消掉方块",this.Text.size=40,this.Text.x=(450-this.Text.width)/2,this.Text.y=40,this.Text.textColor=13421225,this.addChild(this.Text)},e.prototype.ChangeText=function(t){0==t?(this.Text.text="消掉方块",this.Type=t):(this.Text.text="换一批",this.Type=t),this.Text.x=(450-this.Text.width)/2},e}(egret.Sprite);__reflect(MessageView.prototype,"MessageView");var Scene=function(t){function e(){var e=t.call(this)||this;return e.InfoBoard=new Board,e.Bottom=new Bottom,e.Message=new MessageView,e.Data=new Data,e.hangBigBrick=new BrickView,e.hangSmallBrick=new BrickView,e.ScoreText=new egret.TextField,e.lastX=0,e.lastY=0,e.hasClick=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.Init()},e.prototype.infoBoardInit=function(){this.InfoBoard.Init(),this.InfoBoard.x=21,this.InfoBoard.y=150,this.addChild(this.InfoBoard)},e.prototype.bottomInit=function(){this.Bottom.Init(),this.Bottom.x=21,this.Bottom.y=900,this.addChild(this.Bottom)},e.prototype.scoreInit=function(){this.ScoreText.text="0",this.ScoreText.size=80,this.ScoreText.x=540,this.ScoreText.y=60,this.ScoreText.textColor=4532007,this.addChild(this.ScoreText)},e.prototype.Init=function(){this.bgInit(),this.infoBoardInit(),this.bottomInit(),this.scoreInit(),this.Data.Init(),this.NewSmallBrick(),this.messageInit(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.Bottom.touchEnabled=!0,this.Bottom.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.bgInit=function(){this.Layer=new egret.Shape,this.Layer.graphics.beginFill(4532007,.5),this.Layer.graphics.drawRect(0,0,750,1334),this.Layer.graphics.endFill(),this.addChild(this.Layer)},e.prototype.NewSmallBrick=function(){for(var t=0;3>t;t++){var e=Math.floor(31*Math.random())+1,i=Math.floor(Math.random()*Brick.ColorList.length);this.Bottom.AddSmallBrick(Brick.ColorList[i],t,e)}},e.prototype.onTouchBegin=function(t){if(!this.hasClick){var e=Math.floor(t.stageX/140);if(e>=1&&3>=e){var i=this.Bottom.SmallBrickList[e-1];if(null==i||i.IsDel)return;this.hangBigBrick=this.Bottom.AddBigBrick(i.Color,i.Order,i.Type),this.hangSmallBrick=i,this.lastX=0,this.lastY=0,this.hasClick=!0,this.hangSmallBrick.visible=!1}else 4==e?(this.Message.ChangeText(e),this.Message.visible=!0):0==e&&(this.Message.ChangeText(e),this.Message.visible=!0)}},e.prototype.renewSmall=function(){this.Bottom.DelAllSmall(),this.NewSmallBrick()},e.prototype.messageInit=function(){this.Message.visible=!1,this.Message.Init(),this.Message.x=150,this.Message.y=500,this.addChild(this.Message),this.Message.YesButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.yesTap,this),this.Message.NoButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.noTap,this)},e.prototype.yesTap=function(t){if(0==this.Message.Type)for(var e=this.Data.Reduce(),i=0;i<e.length;i++)this.InfoBoard.DeleteLayerGrid(e[i]);else 4==this.Message.Type&&this.renewSmall();this.Message.visible=!1},e.prototype.noTap=function(t){this.Message.visible=!1},e.prototype.onTouchMove=function(t){this.hasClick&&(0==this.lastX?this.lastX=t.stageX:(this.hangBigBrick.x+=t.stageX-this.lastX,this.lastX=t.stageX),0==this.lastY?this.lastY=t.stageY:(this.hangBigBrick.y+=t.stageY-this.lastY,this.lastY=t.stageY))},e.prototype.onTouchEnd=function(t){if(this.hasClick){this.hasClick=!1;var e=Brick.BrickMap[this.hangBigBrick.Type],i=Math.floor((this.hangBigBrick.x+e.BigX+44)/88),r=Math.floor((this.hangBigBrick.y+e.BigY+750+44)/88),n=this.Data.AddBrick(this.hangBigBrick.Type,i,r,this.hangBigBrick.Color);if(!n)return this.hangSmallBrick.visible=!0,this.Bottom.removeChild(this.hangBigBrick),void(this.hangBigBrick=null);for(var a=i+8*r,o=0;o<e.DotList.length;o++)this.InfoBoard.DrawLayerGrid(e.DotList[o]+a,this.hangBigBrick.Color);this.Bottom.removeChild(this.hangBigBrick),this.hangBigBrick=null,this.hangSmallBrick.IsDel=!0,this.Bottom.CheckEmpty()&&this.NewSmallBrick();var s=this.Data.Clean();if(null!=s&&s.length>0)for(var o=0;o<s.length;o++)this.InfoBoard.DeleteLayerGrid(s[o]);this.ScoreText.text=this.Data.Score.toString()}},e}(eui.UILayer);__reflect(Scene.prototype,"Scene");