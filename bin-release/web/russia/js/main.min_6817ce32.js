var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,o){function a(t){try{h(i.next(t))}catch(e){o(e)}}function s(t){try{h(i["throw"](t))}catch(e){o(e)}}function h(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(a,s)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return i([t,e])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,o&&(a=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,o=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){h.label=r[1];break}if(6===r[0]&&h.label<a[1]){h.label=a[1],a=r;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(r);break}a[2]&&h.ops.pop(),h.trys.pop();continue}r=e.call(t,h)}catch(i){r=[6,i],o=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,o,a,s,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Brick=function(){function t(t,e,r,i,n,o){this.Type=0,this.DotList=new Array,this.SmallX=0,this.SmallY=0,this.BigX=0,this.BigY=0,this.SmallSide=26,this.BigSide=84,this.SmallGap=2,this.BigGap=4,this.Type=t,this.SmallX=e,this.SmallY=r,this.BigX=i,this.BigY=n,this.DotList=o}return t.BrickMap={1:new t(1,57,57,180,180,[0]),2:new t(2,43,57,136,180,[0,1]),3:new t(3,29,57,92,180,[0,1,2]),4:new t(4,15,57,48,180,new Array(0,1,2,3)),5:new t(5,1,57,4,180,new Array(0,1,2,3,4)),6:new t(6,57,43,180,136,new Array(0,8)),7:new t(7,57,29,180,92,new Array(0,8,16)),8:new t(8,57,15,180,48,new Array(0,8,16,24)),9:new t(9,57,1,180,4,new Array(0,8,16,24,32)),10:new t(10,43,43,136,136,new Array(0,1,8,9)),11:new t(11,29,29,92,92,new Array(0,1,2,8,9,10,16,17,18)),12:new t(12,43,43,136,136,new Array(1,8,9)),13:new t(13,43,43,136,136,new Array(0,8,9)),14:new t(14,43,43,136,136,new Array(0,1,9)),15:new t(15,43,43,136,136,new Array(0,1,8)),16:new t(16,43,29,136,92,new Array(0,8,16,17)),17:new t(17,29,43,92,136,new Array(2,8,9,10)),18:new t(18,43,29,136,92,new Array(0,1,9,17)),19:new t(19,29,43,92,136,new Array(0,1,2,8)),20:new t(20,43,29,136,92,new Array(1,9,16,17)),21:new t(21,29,43,92,136,new Array(0,1,2,10)),22:new t(22,43,29,136,92,new Array(0,1,8,16)),23:new t(23,29,43,92,136,new Array(0,8,9,10)),24:new t(24,29,43,92,136,new Array(0,1,9,10)),25:new t(25,29,43,92,136,new Array(1,2,8,9)),26:new t(26,29,43,92,136,new Array(1,8,9,10)),27:new t(27,29,43,92,136,new Array(0,1,2,9)),28:new t(28,29,29,92,92,new Array(0,1,2,10,18)),29:new t(29,29,29,92,92,new Array(2,10,16,17,18)),30:new t(30,29,29,92,92,new Array(0,8,16,17,18)),31:new t(31,29,29,92,92,new Array(0,1,2,8,16))},t.ColorList=new Array(11977370,8630171,13158569,16371117,16555418,16663397,9082747,16044032,15041288,14440210,4557204),t}();__reflect(Brick.prototype,"Brick");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function i(i){e.call(r,i,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?i(n):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return r.sent(),this.stage.removeChild(t),[3,5];case 4:return e=r.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,r){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.addChild(new Scene)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,i){function n(t){e.call(i,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),r.call(i))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,r){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var h=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(h,function(r){window.JSONParseClass.setData(r),egret.callLater(function(){e.call(i,generateJSON.paths[t])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Data=function(){function t(){this.List=new Array(64),this.Score=0}return t.prototype.Init=function(){for(var t=0;64>t;t++){var e=new Piece;e.Color=-1,e.Index=t,this.List[t]=e}this.initBrick()},t.prototype.initBrick=function(){},t.prototype.AddBrick=function(t,e,r){if(0>e)return!1;for(var i=Brick.BrickMap[t],n=0;n<i.DotList.length;n++){if(e+i.DotList[n]>63)return!1;if(-1!=this.List[e+i.DotList[n]].Color)return!1}for(var n=0;n<i.DotList.length;n++)this.List[e+i.DotList[n]].Color=r;return this.Score+=i.DotList.length,!0},t.prototype.Clean=function(){for(var t={},e=new Array,r=0;8>r;r++){for(var i=!0,n=0;8>n;n++)if(-1==this.List[8*r+n].Color){i=!1;break}if(i)for(var n=0;8>n;n++)t[8*r+n]=8*r+n}for(var n=0;8>n;n++){for(var i=!0,r=0;8>r;r++)if(-1==this.List[8*r+n].Color){i=!1;break}if(i)for(var r=0;8>r;r++)t[8*r+n]=8*r+n}var o;for(o in t){e.push(o),this.Score++;var a=this.List[o];null!=a&&(a.Color=-1)}return e},t.prototype.Check=function(){return!1},t.prototype.Reduce=function(){for(var t=new Array,e=new Array,r=0;r<this.List.length;r++)-1!=this.List[r].Color&&e.push(this.List[r].Index);for(var i=Math.floor(e.length/2),n=-1;;){if(0>=i)break;if(n>=e.length-1)break;var o=Math.floor(2*Math.random())+1;t.push(e[n+o]),n+=2,i--}for(var r=0;r<t.length;r++)this.List[t[r]].Color=-1;return t},t}();__reflect(Data.prototype,"Data");var Piece=function(){function t(){}return t}();__reflect(Piece.prototype,"Piece");var Board=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ColorList=new Array(64),e}return __extends(e,t),e.prototype.bgInit=function(){this.Layer=new egret.Shape,this.Layer.graphics.beginFill(0,1),this.Layer.graphics.drawRect(0,0,708,708),this.Layer.graphics.endFill(),this.addChild(this.Layer);for(var t=0;64>t;t++)this.darwGrid(t)},e.prototype.darwGrid=function(t){var e=Math.floor(t/8),r=t%8,i=new egret.Shape;i.graphics.beginFill(4532007,1),i.graphics.drawRect(4+88*r,4+88*e,84,84),i.graphics.endFill(),this.addChild(i)},e.prototype.DrawLayerGrid=function(t,e){var r=Math.floor(t/8),i=t%8,n=new egret.Shape;n.graphics.beginFill(e,1),n.graphics.drawRect(4+88*i,4+88*r,84,84),n.graphics.endFill(),this.ColorList[t]=n,this.addChild(n)},e.prototype.DeleteLayerGrid=function(t){var e=this.ColorList[t];null!=e&&this.removeChild(e)},e.prototype.Init=function(){this.bgInit()},e}(egret.Sprite);__reflect(Board.prototype,"Board");var Bottom=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.SmallBrickList=new Array(3),e}return __extends(e,t),e.prototype.bgInit=function(){this.Layer=new egret.Shape,this.Layer.graphics.beginFill(4532007,1),this.Layer.graphics.drawRect(0,0,716,200),this.Layer.graphics.endFill(),this.addChild(this.Layer)},e.prototype.AddSmallBrick=function(t,e,r){var i=new BrickView;return i.Order=e,i.Color=t,i.Type=r,i.GenSmallBrick(t,r),i.x=140+140*e,i.y=30,this.addChild(i),this.SmallBrickList[e]=i,i},e.prototype.AddBigBrick=function(t,e,r){var i=new BrickView;return i.Order=e,i.Color=t,i.Type=r,i.GenBigBrick(t,r),i.x=12+140*e,i.y=-356,this.addChild(i),i},e.prototype.DelAllSmall=function(){for(var t=0;t<this.SmallBrickList.length;t++)this.removeChild(this.SmallBrickList[t])},e.prototype.CheckEmpty=function(){for(var t=0;t<this.SmallBrickList.length;t++)if(!this.SmallBrickList[t].IsDel)return!1;for(var t=0;t<this.SmallBrickList.length;t++)this.removeChild(this.SmallBrickList[t]);return!0},e.prototype.hammerInit=function(){this.Hammer=new egret.Sprite;var t=new egret.Shape;t.graphics.beginFill(16777215,.5),t.graphics.drawRect(20,40,100,50),t.graphics.endFill(),this.Hammer.addChild(t);var e=new egret.Shape;e.graphics.beginFill(16777215,.5),e.graphics.drawRect(50,90,40,75),e.graphics.endFill(),this.Hammer.addChild(e),this.addChild(this.Hammer)},e.prototype.changeInit=function(){this.Change=new egret.Sprite,this.Change.graphics.beginFill(16777215,.5),this.Change.graphics.drawArc(640,100,60,0,2*Math.PI),this.Change.graphics.endFill(),this.addChild(this.Change)},e.prototype.Init=function(){this.bgInit(),this.hammerInit(),this.changeInit()},e}(egret.Sprite);__reflect(Bottom.prototype,"Bottom");var BrickView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Order=-1,e.Color=0,e.Type=0,e.IsDel=!1,e}return __extends(e,t),e.prototype.GenSmallBrick=function(t,e){for(var r=Brick.BrickMap[e],i=0;i<r.DotList.length;i++){var n=new egret.Shape;n.graphics.beginFill(t,1);var o=r.SmallX+Math.floor(r.DotList[i]%8)*(r.SmallGap+r.SmallSide),a=r.SmallY+Math.floor(r.DotList[i]/8)*(r.SmallGap+r.SmallSide);n.graphics.drawRect(0,0,r.SmallSide,r.SmallSide),n.graphics.endFill(),n.x=Math.floor(o),n.y=a,this.addChild(n)}},e.prototype.GenBigBrick=function(t,e){for(var r=Brick.BrickMap[e],i=0;i<r.DotList.length;i++){var n=new egret.Shape;n.graphics.beginFill(t,1);var o=r.BigX+Math.floor(r.DotList[i]%8)*(r.BigGap+r.BigSide),a=r.BigY+Math.floor(r.DotList[i]/8)*(r.BigGap+r.BigSide);n.graphics.drawRect(0,0,r.BigSide,r.BigSide),n.graphics.endFill(),n.x=Math.floor(o),n.y=a,this.addChild(n)}},e}(egret.Sprite);__reflect(BrickView.prototype,"BrickView");var Scene=function(t){function e(){var e=t.call(this)||this;return e.InfoBoard=new Board,e.Bottom=new Bottom,e.Data=new Data,e.hangBigBrick=new BrickView,e.hangSmallBrick=new BrickView,e.ScoreText=new egret.TextField,e.lastX=0,e.lastY=0,e.hasClick=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.Init()},e.prototype.infoBoardInit=function(){this.InfoBoard.Init(),this.InfoBoard.x=21,this.InfoBoard.y=150,this.addChild(this.InfoBoard)},e.prototype.bottomInit=function(){this.Bottom.Init(),this.Bottom.x=21,this.Bottom.y=900,this.addChild(this.Bottom)},e.prototype.scoreInit=function(){this.ScoreText.text="0",this.ScoreText.size=80,this.ScoreText.x=540,this.ScoreText.y=60,this.ScoreText.textColor=4532007,this.addChild(this.ScoreText)},e.prototype.Init=function(){this.bgInit(),this.infoBoardInit(),this.bottomInit(),this.scoreInit(),this.Data.Init(),this.NewSmallBrick(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.Bottom.touchEnabled=!0,this.Bottom.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.bgInit=function(){this.Layer=new egret.Shape,this.Layer.graphics.beginFill(4532007,.5),this.Layer.graphics.drawRect(0,0,750,1334),this.Layer.graphics.endFill(),this.addChild(this.Layer)},e.prototype.NewSmallBrick=function(){for(var t=0;3>t;t++){var e=Math.floor(31*Math.random())+1,r=Math.floor(Math.random()*Brick.ColorList.length);this.Bottom.AddSmallBrick(Brick.ColorList[r],t,e)}},e.prototype.onTouchBegin=function(t){if(!this.hasClick){var e=Math.floor(t.stageX/140);if(e>=1&&3>=e){var r=this.Bottom.SmallBrickList[e-1];if(null==r)return;this.hangBigBrick=this.Bottom.AddBigBrick(r.Color,r.Order,r.Type),this.hangSmallBrick=r,this.lastX=0,this.lastY=0,this.hasClick=!0,this.hangSmallBrick.visible=!1,this.hangSmallBrick.IsDel=!0}else if(4==e)this.renewSmall();else if(0==e)for(var i=this.Data.Reduce(),n=0;n<i.length;n++)this.InfoBoard.DeleteLayerGrid(i[n])}},e.prototype.renewSmall=function(){this.Bottom.DelAllSmall(),this.NewSmallBrick()},e.prototype.onTouchMove=function(t){this.hasClick&&(0==this.lastX?this.lastX=t.stageX:(this.hangBigBrick.x+=t.stageX-this.lastX,this.lastX=t.stageX),0==this.lastY?this.lastY=t.stageY:(this.hangBigBrick.y+=t.stageY-this.lastY,this.lastY=t.stageY))},e.prototype.onTouchEnd=function(t){if(this.hasClick){this.hasClick=!1;var e=Brick.BrickMap[this.hangBigBrick.Type],r=Math.floor((this.hangBigBrick.x+e.BigX+44)/88),i=Math.floor((this.hangBigBrick.y+e.BigY+750+44)/88),n=r+8*i,o=this.Data.AddBrick(this.hangBigBrick.Type,n,this.hangBigBrick.Color);if(!o)return this.hangSmallBrick.visible=!0,this.Bottom.removeChild(this.hangBigBrick),void(this.hangBigBrick=null);for(var a=0;a<e.DotList.length;a++)this.InfoBoard.DrawLayerGrid(e.DotList[a]+n,this.hangBigBrick.Color);this.Bottom.removeChild(this.hangBigBrick),this.hangBigBrick=null,this.Bottom.CheckEmpty()&&this.NewSmallBrick();var s=this.Data.Clean();if(null!=s&&s.length>0)for(var a=0;a<s.length;a++)this.InfoBoard.DeleteLayerGrid(s[a]);this.ScoreText.text=this.Data.Score.toString()}},e}(eui.UILayer);__reflect(Scene.prototype,"Scene");